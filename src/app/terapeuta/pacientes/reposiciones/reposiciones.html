<div class="repos-wrapper">

  <header class="repos-header">
    <div>
      <h1>Reposiciones</h1>
      <p class="subtitle">Sesiones reprogramadas de tus pacientes.</p>
    </div>

    <div class="filtros">
      <button
        [class.active]="filtroEstado() === 'TODOS'"
        (click)="cambiarFiltro('TODOS')">
        Todas
      </button>

      @for (e of estadosDisponibles(); track e.codigo) {
        <button
          [class.active]="filtroEstado() === e.codigo"
          (click)="cambiarFiltro(e.codigo)">
          {{ e.descripcion }}
        </button>
      }
    </div>
  </header>

  @if (mensajeError()) {
    <div class="alert error">{{ mensajeError() }}</div>
  }

  @if (mensajeAccion()) {
    <div class="alert info">{{ mensajeAccion() }}</div>
  }

  @if (advertencias().length) {
    <div class="alert warning">
      <strong>Advertencias:</strong>
      <ul>
        @for (a of advertencias(); track a) {
          <li>{{ a }}</li>
        }
      </ul>
    </div>
  }

  @if (cargando()) {
    <p>Cargando reposiciones...</p>
  }

  @if (!cargando()) {

    @if (listaFiltrada().length === 0) {
      <p class="empty">No hay reposiciones con ese filtro.</p>
    }

    <section class="repos-list">
      @for (r of listaFiltrada(); track r.id) {
        <article class="repo-card">
          <div class="left">
            <h3>{{ r.ninoNombre }}</h3>
            <p class="terapia">{{ r.tipoDescripcion }}</p>

            <p class="fechas">
              Original: {{ r.fechaOriginal }} · {{ r.horaOriginal }} <br>
              Nueva: {{ r.fechaNueva }} · {{ r.horaNueva }}
            </p>

            <p class="motivo">
              Motivo: {{ r.motivo }}
            </p>
          </div>

          <div class="right">
            <span class="estado-pill">{{ r.estadoDescripcion }}</span>

            <div class="acciones">
              @if (r.puedeAprobar) {
                <button type="button" (click)="aprobar(r)">Aprobar</button>
              }
              @if (r.puedeRechazar) {
                <button type="button" (click)="rechazar(r)">Rechazar</button>
              }
            </div>
          </div>
        </article>
      }
    </section>
  }

</div>
