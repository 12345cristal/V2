<div class="pacientes-wrapper">

  <header class="pacientes-header">
    <h1>Mis Pacientes</h1>

    <div class="input-group">
      <span class="material-symbols-rounded">search</span>
      <input
        type="text"
        placeholder="Buscar paciente…"
        (input)="filtrar($event)" />
    </div>
  </header>

  @if (mensajeError()) {
    <div class="alert error">{{ mensajeError() }}</div>
  }

  @if (cargando()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando pacientes...</p>
    </div>
  }

  @if (!cargando()) {
    <section class="cards-grid">
      @for (paciente of filtrados(); track paciente.id) {
        <article class="paciente-card">

          <div class="foto">
            <img [src]="paciente.fotografiaUrl || 'assets/default-user.png'">
          </div>

          <div class="info">
            <h3>{{ paciente.nombreCompleto }}</h3>
            <p class="sub">
              {{ paciente.edad }} años • {{ paciente.diagnosticoPrincipal }}
            </p>

            <div class="progreso">
              <div class="top">
                <span>Progreso general</span>
                <strong>{{ paciente.progresoGeneral ?? 0 }}%</strong>
              </div>
              <div class="bar">
                <div class="fill" [style.width.%]="paciente.progresoGeneral ?? 0"></div>
              </div>
            </div>

            @if (paciente.proximaSesionDescripcion) {
              <div class="sesion-info">
                <span class="material-symbols-rounded">event</span>
                {{ paciente.proximaSesionDescripcion }}
              </div>
            }
          </div>

          <div class="acciones">
            <a class="btn-ver" [routerLink]="['/terapeuta/pacientes', paciente.id]">
              <span class="material-symbols-rounded">visibility</span>
              Ver detalle
            </a>
          </div>

        </article>
      }
    </section>
  }

</div>
