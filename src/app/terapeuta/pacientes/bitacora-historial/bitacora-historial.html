<div class="historial-wrapper">

  <h2>Historial de sesiones</h2>

  @if (mensajeError()) {
    <div class="alert error">{{ mensajeError() }}</div>
  }

  @if (cargando()) {
    <p>Cargando historial...</p>
  }

  @if (!cargando()) {

    @if (historial().length === 0) {
      <p class="empty">Aún no hay bitácoras registradas.</p>
    }

    @for (e of historial(); track e.id) {
      <article class="entrada">

        <div class="fecha">
          <strong>{{ e.fecha }}</strong>
          <small>{{ e.hora }}</small>
        </div>

        <div class="contenido">
          <p><strong>Comportamiento:</strong> {{ e.comportamiento }}</p>
          <p><strong>Avance:</strong> {{ e.avance }}</p>
          <p><strong>Actividades:</strong> {{ e.actividadesRealizadas }}</p>
          <p><strong>Recomendaciones:</strong> {{ e.recomendaciones }}</p>

          <div class="progreso">
            <span>Progreso sesión</span>
            <div class="bar">
              <div class="fill" [style.width.%]="e.progresoSesion"></div>
            </div>
          </div>

          @if (e.cumplioObjetivos === false) {
            <p class="warning">No se cumplieron todos los objetivos de la sesión.</p>
          }

          @if (e.requiereSeguimiento) {
            <p class="followup">Requiere seguimiento en próxima sesión.</p>
          }

          @if (e.etiquetas?.length) {
            <div class="tags">
              @for (tag of e.etiquetas; track tag) {
                <span class="tag">{{ tag }}</span>
              }
            </div>
          }
        </div>

      </article>
    }
  }

</div>
