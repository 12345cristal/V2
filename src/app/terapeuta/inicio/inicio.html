<div class="wrap">

  <!-- HEADER -->
  <div class="head">
    <div>
      <h1>Inicio</h1>
      <p class="sub">Resumen de tu semana y accesos rápidos</p>
    </div>

    <button class="btn-outline" (click)="cargar()" [disabled]="cargando">
      {{ cargando ? 'Actualizando…' : 'Actualizar' }}
    </button>
  </div>

  <!-- LOADING -->
  @if (cargando) {
  <div class="loading">
    <div class="spinner"></div>
    <p>Cargando tu dashboard…</p>
  </div>
  }

  <!-- DASHBOARD -->
  @if (!cargando && data) {

  <!-- KPIs -->
  <div class="kpis">
    <div class="kpi">
      <p class="kpi-title">Niños asignados</p>
      <p class="kpi-value">{{ data.resumen.total_ninos }}</p>
    </div>

    <div class="kpi">
      <p class="kpi-title">Citas hoy</p>
      <p class="kpi-value">{{ data.resumen.citas_hoy }}</p>
    </div>

    <div class="kpi">
      <p class="kpi-title">Citas esta semana</p>
      <p class="kpi-value">{{ data.resumen.citas_semana }}</p>
    </div>

    <div class="kpi">
      <p class="kpi-title">Tareas pendientes</p>
      <p class="kpi-value">{{ data.resumen.tareas_pendientes }}</p>
    </div>

    <div class="kpi">
      <p class="kpi-title">Recursos nuevos</p>
      <p class="kpi-value">{{ data.resumen.recursos_nuevos }}</p>
    </div>
  </div>

  <!-- ACCESOS RÁPIDOS -->
  <div class="quick">
    <a class="quick-card" routerLink="/terapeuta/ninos">
      <h3>Mis niños</h3>
      <p>Listado completo y accesos a actividades, asistencias y reportes.</p>
    </a>

    <a class="quick-card" routerLink="/terapeuta/horario">
      <h3>Mi horario</h3>
      <p>Consulta tus sesiones de la semana.</p>
    </a>

    <a class="quick-card" routerLink="/terapeuta/recursos">
      <h3>Recursos</h3>
      <p>Sube y consulta material educativo global.</p>
    </a>

    <a class="quick-card" routerLink="/terapeuta/reportes">
      <h3>Reportes</h3>
      <p>Registra observaciones por sesión y avances.</p>
    </a>
  </div>

  <div class="grid-2">

    <!-- PRÓXIMAS CITAS -->
    <div class="card">
      <div class="card-head">
        <h2>Próximas citas</h2>
        <a class="link" routerLink="/terapeuta/horario">Ver horario</a>
      </div>

      @if (data.proximas_citas.length === 0) {
      <div class="empty">
        No tienes citas próximas.
      </div>
      }

      <div class="list">
        @for (c of data.proximas_citas.slice(0, 3); track c.id) {
        <div class="row">
          <div class="row-left">
            <p class="row-title">{{ c.nino_nombre }}</p>
            <p class="row-sub">{{ c.terapia_nombre }}</p>
          </div>
          <div class="row-right">
            <span class="pill">{{ c.fecha }}</span>
            <span class="pill">{{ c.hora_inicio }} - {{ c.hora_fin }}</span>
          </div>
        </div>
        }
      </div>
    </div>

    <!-- NIÑOS -->
    <div class="card">
      <div class="card-head">
        <h2>Mis niños</h2>
        <a class="link" routerLink="/terapeuta/ninos">Ver todos</a>
      </div>

      @if (data.ninos.length === 0) {
      <div class="empty">
        Aún no tienes niños asignados.
      </div>
      }

      <div class="list">
        @for (n of data.ninos.slice(0, 4); track n.id) {
        <a class="row row-link" [routerLink]="['/terapeuta/ninos', n.id]">
          <div class="row-left">
            <p class="row-title">{{ n.nombre }} {{ n.apellido_paterno }}</p>
            <p class="row-sub">Estado: {{ n.estado }}</p>
          </div>
          <div class="row-right">
            <span class="chev">›</span>
          </div>
        </a>
        }
      </div>
    </div>

  </div>
  }

</div>
