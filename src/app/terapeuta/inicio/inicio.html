<div class="wrap">

  <!-- HEADER -->
  <div class="head">
    <div>
      <h1>Inicio</h1>
      <p class="sub" *ngIf="!cargando">{{ getHoy() }}</p>
    </div>

    <button class="btn-outline" (click)="cargar()" [disabled]="cargando">
      {{ cargando ? 'Actualizando‚Ä¶' : 'Actualizar' }}
    </button>
  </div>

  <!-- LOADING -->
  @if (cargando) {
  <div class="loading">
    <div class="spinner"></div>
    <p>Cargando tu dashboard‚Ä¶</p>
  </div>
  }

  <!-- DASHBOARD -->
  @if (!cargando && data) {

  <!-- KPIs GRID -->
  <div class="kpis">
    <div class="kpi">
      <!-- <div class="kpi-icon">üë•</div> -->
      <p class="kpi-title">Terapeutas Activos</p>
      <p class="kpi-value">{{ data.resumen.total_ninos }}</p>
      <p class="kpi-sub">pacientes</p>
    </div>

    <div class="kpi">
      <!-- <div class="kpi-icon">üìÖ</div> -->
      <p class="kpi-title">Citas Esta Semana</p>
      <p class="kpi-value">{{ data.resumen.citas_semana }}</p>
      <p class="kpi-sub">sesiones</p>
    </div>

    <div class="kpi">
      <!-- <div class="kpi-icon">üë∂</div> -->
      <p class="kpi-title">Ni√±os Activos</p>
      <p class="kpi-value">{{ data.resumen.citas_hoy }}</p>
      <p class="kpi-sub">activos</p>
    </div>
  </div>

  <div class="grid-2">

    <!-- PACIENTES DESTACADOS -->
    <div class="card">
      <div class="card-head">
        <!-- <div class="card-title-icon">üë®‚Äç‚öïÔ∏è</div> -->
        <div>
          <h2>Pacientes Destacados</h2>
          <p class="card-sub">Top 3 con mejor evaluaci√≥n</p>
        </div>
      </div>

      @if (data.ninos && data.ninos.length > 0) {
      <div class="therapist-list">
        @for (nino of data.ninos.slice(0, 3); track nino.id) {
        <div class="therapist-item">
          <div class="therapist-avatar"
            [style.backgroundColor]="getColorByIndex($index)">
            {{ nino.nombre.charAt(0) }}{{ nino.apellido_paterno.charAt(0) }}
          </div>
          <div class="therapist-info">
            <p class="therapist-name">{{ nino.nombre }} {{ nino.apellido_paterno
              }}</p>
            <p class="therapist-role">
              {{ nino.estado === 'ACTIVO' ? 'Activo' : nino.estado ===
              'BAJA_TEMPORAL' ? 'Baja Temporal' : 'Inactivo' }}
            </p>
          </div>
          <div class="therapist-stats">
            <div class="stat">
              <span class="stat-value">0</span>
              <span class="stat-label">SESIONES</span>
            </div>
            <div class="stat">
              <span class="stat-value">+5</span>
              <span class="stat-label">RATING</span>
            </div>
          </div>
          <button class="btn-action">Ver perfil</button>
        </div>
        }
      </div>
      } @else {
      <div class="empty">No tienes pacientes asignados.</div>
      }
    </div>

    <!-- ATENCI√ìN PRIORITARIA -->
    <div class="card">
      <div class="card-head">
        <!-- <div class="card-icon">‚ö†Ô∏è</div> -->
        <div>
          <h2>Atenci√≥n Prioritaria</h2>
          <p class="card-sub">Ni√±os que requieren seguimiento</p>
        </div>
      </div>

      @if (data.ninos && data.ninos.length > 0) {
      <div class="priority-list">
        @for (nino of data.ninos.slice(0, 3); track nino.id) {
        <div class="priority-item">
          <div class="priority-header">
            <p class="priority-name">{{ nino.nombre }} {{ nino.apellido_paterno
              }}</p>
            @if (nino.estado === 'BAJA_TEMPORAL') {
            <span class="badge-priority">BAJA</span>
            }
          </div>
          <p class="priority-text">Sin citas en los √∫ltimos 15 d√≠as</p>
        </div>
        }
      </div>
      } @else {
      <div class="empty">No hay ni√±os con atenci√≥n prioritaria.</div>
      }
    </div>

  </div>

  <!-- PR√ìXIMAS CITAS -->
  @if (data.proximas_citas && data.proximas_citas.length > 0) {
  <div class="card">
    <div class="card-head">
      <h2>Pr√≥ximas Citas</h2>
      <a class="link" routerLink="/terapeuta/asistencias">Ver horario</a>
    </div>

    <div class="citas-list">
      @for (c of data.proximas_citas.slice(0, 5); track c.id) {
      <div class="cita-row">
        <div class="cita-time">
          <p class="cita-hora">{{ c.hora_inicio }}</p>
          <p class="cita-fecha">{{ c.fecha | date: 'MMM d' }}</p>
        </div>
        <div class="cita-info">
          <p class="cita-nino">{{ c.nino_nombre }}</p>
          <p class="cita-terapia">{{ c.terapia_nombre }}</p>
        </div>
        <div class="cita-status">
          <span class="badge-status">Programada</span>
        </div>
      </div>
      }
    </div>
  </div>
  }
  }

</div>
