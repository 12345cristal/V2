<div class="horarios-wrapper">

  <header class="horarios-header">
    <div>
      <h1>Mis horarios</h1>
      <p class="subtitle">Consulta y gestiona tus sesiones de esta semana.</p>
    </div>

    <div class="vista-toggle">
      <button [class.active]="vista() === 'lista'" (click)="cambiarVista('lista')">Lista</button>
      <button [class.active]="vista() === 'agenda'" (click)="cambiarVista('agenda')">Agenda semanal</button>
    </div>
  </header>

  @if (mensajeAccion()) {
    <div class="alert info">{{ mensajeAccion() }}</div>
  }

  @if (advertencias().length) {
    <div class="alert warning">
      <strong>Advertencias:</strong>
      <ul>
        @for (a of advertencias(); track a) {
          <li>{{ a }}</li>
        }
      </ul>
    </div>
  }

  @if (cargando()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Cargando horarios...</p>
    </div>
  }

  @if (!cargando()) {

    <!-- ============================
         VISTA LISTA
    ============================ -->
    @if (vista() === 'lista') {
      <section class="lista-sesiones">
        @for (s of sesionesOrdenadas(); track s.id) {
          <article class="sesion-item">
            <div class="left">
              <h3>{{ s.ninoNombre }}</h3>
              <p class="tipo">{{ s.tipoDescripcion }}</p>
              <p class="fecha">
                {{ s.diaNombre }} · {{ s.horaInicio }} – {{ s.horaFin }}
                @if (s.sala) {
                  · Sala {{ s.sala }}
                }
              </p>
              <p class="estado">{{ s.estadoDescripcion }}</p>
            </div>

            <div class="right">
              @if (s.esReposicion) {
                <span class="badge repo">Reposición</span>
              }

              @if (s.puedeMarcarComoCompletada) {
                <button class="btn-mini" type="button" (click)="marcarCompletada(s)">
                  Marcar completada
                </button>
              }
            </div>
          </article>
        }
      </section>
    }

    <!-- ============================
         VISTA AGENDA SEMANAL
    ============================ -->
    @if (vista() === 'agenda') {

      <section class="agenda-grid">

        <div class="corner"></div>

        @for (d of diasSemana; track d.num) {
          <div class="day-header">{{ d.label }}</div>
        }

        @for (h of horas; track h) {

          <div class="hour-label">{{ h }}</div>

          @for (d of diasSemana; track d.num) {
            <div class="agenda-cell">
              @for (s of sesionesEnSlot(d.num, h); track s.id) {
                <div class="sesion-badge" [class.repo]="s.esReposicion">
                  <span class="nombre">{{ s.ninoNombre }}</span>
                  <span class="tipo">{{ s.tipoDescripcion }}</span>
                </div>
              }
            </div>
          }
        }

      </section>
    }
  }
</div>
