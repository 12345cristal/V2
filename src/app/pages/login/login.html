<app-header></app-header>

<div class="login-container">
  <div class="login-card">

    <!-- Panel Izquierdo -->
    <div class="illustration">
      <div class="content">
        <img src="autismo_mochis.png" class="logo">
        <h2>Bienvenido a Autismo Mochis</h2>
        <p>Una plataforma integral para la gestión terapéutica.</p>
      </div>
    </div>

    <!-- Formulario -->
    <div class="login-form-section">
      <h3>Iniciar sesión</h3>

      <!-- Estado del backend -->
      @if (backendStatus() === 'offline') {
      <div class="alert alert-warning">
        Backend no disponible.
        <button type="button" (click)="reintentarBackend()"
          style="margin-left: 8px;">
          Reintentar
        </button>
      </div>
      }
      @else if (backendStatus() === 'loading') {
      <div class="alert alert-info">
        Verificando conexión con el servidor...
      </div>
      }

      @if (mensajeError()) {
      <div class="alert alert-error">{{ mensajeError() }}</div>
      }

      <form [formGroup]="loginForm" (ngSubmit)="login()">

        <!-- CORREO -->
        <div class="form-group"
          [class.has-error]="control('correo').touched && control('correo').invalid">

          <label>Correo electrónico</label>
          <input type="email" formControlName="correo"
            placeholder="ejemplo@correo.com">

          @if (control('correo').touched && control('correo').invalid) {
          <div class="field-error">
            @if (control('correo').errors?.['required']) { El correo es
            obligatorio. }
            @else if (control('correo').errors?.['email']) { Ingresa un correo
            válido. }
          </div>
          }
        </div>

        <!-- CONTRASEÑA -->
        <div class="form-group password-field"
          [class.has-error]="control('contrasena').touched && control('contrasena').invalid">

          <label>Contraseña</label>
          <input [type]="mostrarPassword ? 'text' : 'password'"
            formControlName="contrasena">

          <span class="toggle-password" (click)="togglePassword()">
            {{ mostrarPassword ? 'Ocultar' : 'Ver' }}
          </span>

          @if (control('contrasena').touched && control('contrasena').invalid) {
          <div class="field-error">
            @if (control('contrasena').errors?.['required']) { La contraseña es
            obligatoria. }
            @else if (control('contrasena').errors?.['minlength']) { Mínimo 6
            caracteres. }
          </div>
          }
        </div>

        <button type="submit" [disabled]="loginForm.invalid">
          <span>Ingresar</span>
        </button>

      </form>
    </div>

  </div>
</div>

<app-footer></app-footer>
