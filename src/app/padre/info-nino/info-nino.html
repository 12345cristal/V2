<!-- src/app/padre/info-nino/info-nino.html -->

<div class="nino-info-wrapper">

  @if (cargando()) {
    <div class="center-message">Cargando información...</div>
  }
  @else if (error()) {
    <div class="alert error">{{ error() }}</div>
  }
  @else if (!nino()) {
    <div class="center-message">No se encontró la información del niño.</div>
  }
  @else {

    <!-- HEADER -->
    <header class="nino-header">
      <div class="nino-main">
        <div class="nino-avatar">
          {{ nino()!.nombre[0] | uppercase }}
        </div>

        <div>
          <h1>{{ obtenerNombreCompleto() }}</h1>
          <p class="subtitle">
            Edad: <strong>{{ edadCalculada() ?? '—' }}</strong> ·
            Sexo:
            <strong>
              @if (nino()!.sexo === 'M') { Masculino }
              @else if (nino()!.sexo === 'F') { Femenino }
              @else { Otro }
            </strong>
          </p>
        </div>
      </div>

      <div class="nino-header-actions">

        @if (!modoEdicion()) {
          <button class="btn-primary" (click)="activarEdicion()">Editar</button>
        }
        @else {
          <div class="edit-actions">
            <button class="btn-outline" (click)="cancelarEdicion()">Cancelar</button>
            <button class="btn-primary" (click)="guardarCambios()" [disabled]="guardando()">
              {{ guardando() ? 'Guardando...' : 'Guardar' }}
            </button>
          </div>
        }
      </div>
    </header>

    @if (mensajeExito()) {
      <div class="alert success">{{ mensajeExito() }}</div>
    }

    <div class="nino-grid">

      <!-- DATOS BÁSICOS -->
      <section class="card">
        <h2>Datos personales</h2>

        <form [formGroup]="datosForm" class="form-grid">

          <div class="form-field">
            <label>Nombre</label>
            <input type="text" formControlName="nombre" [readonly]="!modoEdicion()">
          </div>

          <div class="form-field">
            <label>Apellido paterno</label>
            <input type="text" formControlName="apellidoPaterno" [readonly]="!modoEdicion()">
          </div>

          <div class="form-field">
            <label>Apellido materno</label>
            <input type="text" formControlName="apellidoMaterno" [readonly]="!modoEdicion()">
          </div>

          <div class="form-field">
            <label>Fecha nacimiento</label>
            <input type="date" formControlName="fechaNacimiento" [readonly]="!modoEdicion()">
          </div>

          <div class="form-field">
            <label>Edad</label>
            <input type="number" [value]="edadCalculada()" disabled>
          </div>

          <div class="form-field">
            <label>Sexo</label>
            <select formControlName="sexo" [disabled]="!modoEdicion()">
              <option value="M">Masculino</option>
              <option value="F">Femenino</option>
              <option value="O">Otro</option>
            </select>
          </div>

        </form>
      </section>

      <!-- DIAGNOSTICO -->
      <section class="card">
        <h2>Diagnóstico</h2>

        <form [formGroup]="diagnosticoForm" class="form-grid">
          <div class="form-field full-width">
            <label>Diagnóstico principal</label>
            <input type="text" formControlName="diagnosticoPrincipal" [readonly]="!modoEdicion()">
          </div>

          <div class="form-field">
            <label>Fecha diagnóstico</label>
            <input type="date" formControlName="fechaDiagnostico" [readonly]="!modoEdicion()">
          </div>

          <div class="form-field full-width">
            <label>Diagnósticos secundarios</label>
            <textarea
              rows="2"
              formControlName="diagnosticosSecundariosTexto"
              [readonly]="!modoEdicion()"
            ></textarea>
          </div>

          <div class="form-field">
            <label>Especialista</label>
            <input type="text" formControlName="especialista" [readonly]="!modoEdicion()">
          </div>

          <div class="form-field">
            <label>Institución</label>
            <input type="text" formControlName="institucion" [readonly]="!modoEdicion()">
          </div>
        </form>
      </section>

      <!-- CONTACTOS DE EMERGENCIA -->
      <section class="card">
        <h2>Contactos de emergencia</h2>

        @for (c of nino()!.contactosEmergencia; track c.nombreCompleto) {
          <div class="sub-card">
            <h3>{{ c.nombreCompleto }}</h3>
            <p><span>Relación:</span> {{ c.relacion }}</p>
            <p><span>Teléfono:</span> {{ c.telefono }}</p>
          </div>
        }
      </section>

    </div>
  }
</div>
