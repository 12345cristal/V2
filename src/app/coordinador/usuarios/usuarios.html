<div class="gestion-usuarios-container">

  <!-- HEADER -->
  <div class="header-section">
    <h1>Gesti√≥n de Usuarios</h1>

    <!-- Tabs -->
    <div class="tabs-container">
      <button
        class="tab-button"
        type="button"
        [class.active]="vistaActual === 'usuarios'"
        (click)="cambiarVista('usuarios')">
        <mat-icon>people</mat-icon>
        Usuarios ({{ usuarios.length }})
      </button>

      <button
        class="tab-button"
        type="button"
        [class.active]="vistaActual === 'personal'"
        (click)="cambiarVista('personal')">
        <mat-icon>person_add</mat-icon>
        Personal sin Usuario ({{ personalSinUsuario.length }})
      </button>
    </div>
  </div>

  <!-- MENSAJES -->
  @if (errorGeneral) {
  <div class="mensaje-error">
    <mat-icon>error</mat-icon>
    {{ errorGeneral }}
  </div>
  }

  @if (mensajeOk) {
  <div class="mensaje-exito">
    <mat-icon>check_circle</mat-icon>
    {{ mensajeOk }}
  </div>
  }

  <!-- BARRA DE B√öSQUEDA -->
  <div class="search-section">
    <mat-icon>search</mat-icon>

    <input
      type="text"
      [placeholder]="vistaActual === 'usuarios' ? 'Buscar usuario...' : 'Buscar personal...'"
      (input)="aplicarFiltro($any($event.target).value)">

    @if (vistaActual === 'usuarios') {
    <button
      class="btn-nuevo"
      type="button"
      (click)="nuevoUsuario()">
      <mat-icon>add</mat-icon>
      Nuevo Usuario
    </button>
    }
  </div>

  <!-- VISTA USUARIOS -->
  @if (vistaActual === 'usuarios') {

  @if (cargandoUsuarios) {
  <div class="loading">
    <mat-icon>hourglass_empty</mat-icon>
    Cargando usuarios...
  </div>
  } @else {
  <app-usuarios-list
    [usuarios]="usuariosFiltrados"
    (editar)="editarUsuario($event)"
    (cambiarEstado)="cambiarEstado($event)">
  </app-usuarios-list>
  }

  }

  <!-- VISTA PERSONAL SIN USUARIO -->
  @if (vistaActual === 'personal') {

  @if (cargandoPersonal) {
  <div class="loading">
    <mat-icon>hourglass_empty</mat-icon>
    Cargando personal...
  </div>
  } @else {

  @if (personalFiltrado.length === 0) {
  <div class="sin-datos">
    <mat-icon>info</mat-icon>
    <p>No hay personal sin usuario registrado</p>
  </div>
  } @else {
  <div class="personal-grid">

    @for (persona of personalFiltrado; track persona.id_personal) {
    <div class="personal-card">

      <!-- üî• CORRECCI√ìN: Se elimin√≥ la clase duplicada "personall-personal-info" -->
      <div class="personal-info">
        <div class="personal-avatar">
          <mat-icon>person</mat-icon>
        </div>

        <div class="personal-datos">
          <h3>
            {{ persona.nombres }} {{ persona.apellido_paterno }} {{
            persona.apellido_materno || '' }}
          </h3>

          <p class="email">
            <mat-icon>email</mat-icon>
            {{ persona.correo_personal || 'Sin correo' }}
          </p>

          @if (persona.telefono_personal) {
          <p class="telefono">
            <mat-icon>phone</mat-icon>
            {{ persona.telefono_personal }}
          </p>
          }

          <p class="rol">
            <mat-icon>badge</mat-icon>
            {{ persona.nombre_rol || 'Sin rol asignado' }}
          </p>
        </div>
      </div>

      <div class="personal-acciones">
        <button
          class="btn-crear-usuario"
          type="button"
          (click)="asignarDesdePersonal(persona)">
          <mat-icon>person_add</mat-icon>
          Crear Usuario
        </button>
      </div>

    </div>
    }

  </div>
  }

  }

  }

  <!-- FORMULARIO -->
  @if (mostrarFormulario) {
  <app-usuario-form
    [formUsuario]="formUsuario"
    [modoEdicion]="modoEdicion"
    [personalSinUsuario]="personalSinUsuario"
    [rolesSistema]="rolesSistema"
    [mostrarErrores]="mostrarErrores"
    (guardar)="guardarUsuario()"
    (cancelar)="cerrarFormulario()">
  </app-usuario-form>
  }

</div>
