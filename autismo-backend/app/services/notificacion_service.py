"""\nNotificacion Service - Lógica de negocio para notificaciones\n"""\n\nfrom typing import List, Optional\nfrom sqlalchemy.orm import Session, joinedload\nfrom fastapi import HTTPException, status\n\nfrom app.models.notificacion import Notificacion\nfrom app.models.usuario import Usuario\nfrom app.schemas.notificacion import NotificacionCreate\n\n\nclass NotificacionService:\n    """Servicio para gestión de notificaciones"""\n    \n    @staticmethod\n    def get_notificaciones_usuario(\n        db: Session,\n        usuario_id: int,\n        leido: Optional[bool] = None,\n        skip: int = 0,\n        limit: int = 50,\n    ) -> List[Notificacion]:\n        """Obtener notificaciones de un usuario"""\n        query = (\n            db.query(Notificacion)\n            .options(joinedload(Notificacion.usuario))\n            .filter(Notificacion.usuario_id == usuario_id)\n        )\n        \n        if leido is not None:\n            query = query.filter(Notificacion.leido == (1 if leido else 0))\n        \n        return query.order_by(Notificacion.fecha_creacion.desc()).offset(skip).limit(limit).all()\n    \n    @staticmethod\n    def create_notificacion(db: Session, notif_data: NotificacionCreate) -> Notificacion:\n        """Crear nueva notificación"""\n        usuario = db.query(Usuario).filter(Usuario.id == notif_data.usuario_id).first()\n        if not usuario:\n            raise HTTPException(\n                status_code=status.HTTP_404_NOT_FOUND,\n                detail=f\"Usuario con ID {notif_data.usuario_id} no encontrado\",\n            )\n        \n        notificacion = Notificacion(**notif_data.model_dump())\n        db.add(notificacion)\n        db.commit()\n        db.refresh(notificacion)\n        return notificacion\n    \n    @staticmethod\n    def marcar_leida(db: Session, notificacion_id: int) -> Notificacion:\n        """Marcar notificación como leída"""\n        notificacion = db.query(Notificacion).filter(Notificacion.id == notificacion_id).first()\n        \n        if not notificacion:\n            raise HTTPException(\n                status_code=status.HTTP_404_NOT_FOUND,\n                detail=f\"Notificación con ID {notificacion_id} no encontrada\",\n            )\n        \n        notificacion.leido = 1\n        db.commit()\n        db.refresh(notificacion)\n        return notificacion\n    \n    @staticmethod\n    def marcar_todas_leidas(db: Session, usuario_id: int) -> dict:\n        """Marcar todas las notificaciones de un usuario como leídas"""\n        count = (\n            db.query(Notificacion)\n            .filter(Notificacion.usuario_id == usuario_id, Notificacion.leido == 0)\n            .update({\"leido\": 1})\n        )\n        \n        db.commit()\n        return {\"message\": f\"{count} notificaciones marcadas como leídas\"}\n    \n    @staticmethod\n    def count_no_leidas(db: Session, usuario_id: int) -> int:\n        """Contar notificaciones no leídas"""\n        return (\n            db.query(Notificacion)\n            .filter(Notificacion.usuario_id == usuario_id, Notificacion.leido == 0)\n            .count()\n        )\n    \n    @staticmethod\n    def delete_notificacion(db: Session, notificacion_id: int) -> dict:\n        """Eliminar notificación"""\n        notificacion = db.query(Notificacion).filter(Notificacion.id == notificacion_id).first()\n        \n        if not notificacion:\n            raise HTTPException(\n                status_code=status.HTTP_404_NOT_FOUND,\n                detail=f\"Notificación con ID {notificacion_id} no encontrada\",\n            )\n        \n        db.delete(notificacion)\n        db.commit()\n        return {\"message\": \"Notificación eliminada exitosamente\"}\n\n\n# Instancia global del servicio\nnotificacion_service = NotificacionService()\n